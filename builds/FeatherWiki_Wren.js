(()=>{function Ca(a){if(!a)return"";var c=[],b=0,g=[],l=0,k=a.length;"\n"!==a[k-1]&&"\n"!==a[k-2]&&(a+="\n\n");a=a.replace(/\\(.)/g,(d,e)=>I[e]||d).replace(/```(.*)\n([^\0]+?)```(?!```)/gm,(d,e,f)=>(c[b]={lang:e,block:G(f)},`{code-${b++}}`)).replace(/`([^`]+?)`/g,(d,e)=>`<code>${G(e)}</code>`).replace(/<([^>\s]+(\/\/|@)[^>\s]+)>/g,(d,e,f)=>`[${e}](${"@"===f?"mailto:":""}${e})`).replace(/(<\/?[a-zA-Z]+[^>]*>)/gm,(d,e)=>(g[l]=e,`{html-${l++}}`)).replace(/^[ \t]*>+ (.*)/gm,"<blockquote>\n$1\n</blockquote>").replace(/(<\/blockquote>\n?<blockquote>)+?/g,
"").replace(/^(#+) +(.*)/gm,(d,e,f)=>`<h${e.length}>${f}</h${e.length}>`).replace(/^([^\n\t ])(.*)\n====+/gm,"<h1>$1$2</h1>").replace(/^([^\n\t ])(.*)\n----+/gm,"<h2>$1$2</h2>").replace(/\n( *[-*]){3,}\n/gm,"<hr>").replace(/\[( |x)\]/g,(d,e)=>`<input type="checkbox" disabled${"x"===e.toLowerCase()?" checked":""}>`).replace(/  +\n/gm,"<br>").replace(/^([^-\+\*\d<\t \n])([^]*?)(?:\n\n)/gm,(d,e,f)=>`<p>${e}${f}</p>
`).replace(/(!?)\[([^\]]*?)\]\(([^\s\n]*)(?:| "(.*)")\)/gm,(d,e,f,h,m)=>{f=G(f);try{h=decodeURI(h)}catch(p){}return h=encodeURI(h),m=m?` title="${G(m)}"`:"",e?`<img src="${h}" alt="${f}"${m}>`:`<a href="${h}"${m}>${f}</a>`}).replace(/^([\t ]*)(?:(-|\+|\*)|(\d+(?:\)|\.))) (.*)/gm,(d,e,f,h,m)=>{e=e.replace(/  /g,"\t");d=h?"o":"u";return`${e}<${d}l><li>${m}</li></${d}l>`});for(k=/<\/li><\/(u|o)l>\n(\t+)<(u|o)l><li>(.*)<\/li><\/(u|o)l>/;a.match(k);)a=a.replace(k,function(d,e,f,h,m,p){return 0<f.length&&
(f=f.substring(1),0<f.length&&(f="\n"+f)),`${f}<${h}l><li>${m}</li></${p}l></li></${e}l>`});a=a.replace(/(<\/ul>\n?[ \t]*<ul>)+?/g,"").replace(/(<\/ol>\n?[ \t]*<ol>)+?/g,"").replace(/\*\*([^\n*]+?)\*\*/g,"<strong>$1</strong>").replace(/__([^\n_]+?)__/g,"<strong>$1</strong>").replace(/\*([^\n*]+?)\*/g,"<em>$1</em>").replace(/_([^\n_]+?)_/g,"<em>$1</em>").replace(/(?:~~)([^~]+?)(?:~~)/g,"<del>$1</del>");for(k=0;k<l;k++)a=a.replace(`{html-${k}}`,g[k]);for(k=0;k<b;k++){let {lang:d,block:e}=c[k];a=a.replace(`{code-${k}}`,
`<pre><code${d?` class="language-${d}"`:""}>${G(e)}</code></pre>`)}return a.trim()}function J(){if(!(this instanceof J))return new J;this._events={ONLOAD:"DOMContentLoaded",TITLE:"DOMTitleChange",RENDER:"render",GO:"go"};this._loaded=!1;this._tree=null;this._view=()=>{};this.emitter=Da("choo.emit");this.emit=this.emitter.emit.bind(this.emitter);this.state={events:this._events,title:document.title,query:Y()};this.emitter.prependListener(this._events.TITLE,a=>{this.state.title=document.title=a})}function Ea(a){if("Tab"===
a.key){let l=this;var c=h=>{document.activeElement!==l&&l.focus();(""===h?document.execCommand("delete"):document.execCommand("insertText",!1,h))||(l.setRangeText(h,l.selectionStart||0,l.selectionEnd||0,"end"),l.dispatchEvent(new InputEvent("input",{text:h,inputType:"insertText"})))};let {selectionStart:k,selectionEnd:d,value:e}=l,f=e.lastIndexOf("\n",k-1)+1;if(a.shiftKey){var b=e.lastIndexOf("\n",d-1)+1,g="\t"!==e.charAt(b)?d:b+1;b=l.value.slice(f,g);let h=b.replace(/(^|\n)(\t| {1,2})/g,"$1");b=
b.length-h.length;l.setSelectionRange(f,g);c(h);c=(c=/\t| {1,2}/.exec(e.slice(f,k)))?c[0].length:0;l.setSelectionRange(k-c,Math.max(k-c,d-b))}else g=e.slice(k,d),0<(null===(b=/\n/g.exec(g))||void 0===b?void 0:b.length)?(g=l.value.slice(f,d-1),b=g.replace(/^|\n/g,"$&\t"),g=b.length-g.length,l.setSelectionRange(f,d-1),c(b),l.setSelectionRange(k+1,d+g)):c("\t");a.preventDefault()}}function T(a,c,b){b=`\\s<${c} id=${b}>`;a=a.match(new RegExp(b+`.+?(?=</${c}>)`,"s"));return(null!=a?a:[]).length?a[0].replace(b.replace("\\s",
""),"").trim():""}function Fa(a){return Z(this,null,function*(){let c=Object.keys(a);return c.length&&!a[c[0]].img&&(yield Promise.all(c.map(b=>new Promise(g=>{let l=new Image;l.src=a[b];l.onload=()=>{a[b]={img:a[b],alt:"image",size:[l.width,l.height]};g()}})))),a})}function Ga(a,c=()=>{}){!confirm("Inserting images increases your wiki's file size. Continue?")||FW.upload("image/*",b=>{aa(b,(g,l,k)=>{if(g){let d=FW.hash.string(g);a.p.img[d.toString()]={alt:prompt("Alt text:",b.name),size:[l,k],img:g};
c({img:g,id:d})}})})}function Ha(a,c,b=()=>{}){a.preventDefault();document.getElementById("g").close();b(c)}function Ia(a){return a.replace(/(?:<img src=")[^"]+#([-\d]+)(?=")/g,'<img src="img:$1:img')}function Ja(a,c){return c?a.replace(/<img /g,"<im "):a.replace(/<im /g,"<img ")}function aa(a,c=()=>{}){let b=new FileReader;b.onload=g=>{let l=new Image;l.src=g.target.result;l.onload=()=>{let k=document.createElement("canvas"),d=l.width,e=l.height,f=prompt("Max width pixels:","400");f=null!=f&&f.length?
parseInt(f):400;let h=prompt("Max height pixels:","350");h=null!=h&&h.length?parseInt(h):350;d>e?d>f&&(e*=f/d,d=f):e>h&&(d*=h/e,e=h);k.width=d;k.height=e;k.getContext("2d").drawImage(l,0,0,d,e);c(k.toDataURL(a.type),d,e)}};b.onerror=g=>{c(null)};b.readAsDataURL(a)}function ba(a){var c=0,b;if(0===a.length)return c;for(b=0;b<a.length;b++){var g=a.charCodeAt(b);c=(c<<5)-c+g;c|=0}return c}function Ka(a){return ba(JSON.stringify(a))}function La(a,c){var b;let g=null!=a?a:null;return g&&(null!=(b=null==
a?void 0:a.match(/\[\[.+?(?=\]\])/g))?b:[]).forEach(l=>{var k;let d=l.replace("[[","").split("|"),e=d[1]?d[0]:d[0].split("#")[0],f=(null!=(k=d[1])?k:d[0]).trim().split("#");d[1]||(f[0]=FW.slug(f[0]));k=c.p.pages.some(h=>h.slug===f[0])||"undefined"!=typeof c.views[f[0]];g=g.replace(`${l}]]`,`<a href="?page=${f.join("#")}"${k?"":" class=e"}>${e}</a>`)}),g}function Ma(a,c,b=!1){var g;let l=null!=a?a:null;return l&&(null!=(g=null==a?void 0:a.match(/img:.+?(?=:img)/g))?g:[]).forEach(k=>{id=k.replace("img:",
"");let d=c.p.img[id];"undefined"!=typeof d&&(l=l.replace(`${k}:img`,d.img+(b?`#${id}`:"")+`" alt="${d.alt}`))}),l}function Na(a){var c;let b=null!=a?a:null;return b&&(null!=(c=null==a?void 0:a.match(/<a href=".+?(?=")/gi))?c:[]).forEach(g=>{b=b.replace(g,`${g}" target="_blank" rel="noopener noreferrer`)}),b}function Oa(a){var c;let b=null!=a?a:null;return b&&(null!=(c=null==a?void 0:a.match(/<h\d>.+?<\/h\d>/gi))?c:[]).forEach(g=>{let l=g.match(/<h(\d)>(.+)<\/h\d>/i),k=FW.slug(l[2]);b=b.replace(g,
`<h${l[1]} id=${k}>${l[2]} <a class=l href=#${k}>#</a></h${l[1]}>`)}),b}function Pa(a,c=!1){var b;return null!=(b=c?null==a?void 0:a.replace(/&[lg]t;/g,g=>{var l;return null!=(l={"&lt;":"<","&gt;":">"}[g])?l:g}):null==a?void 0:a.replace(/[<>]/g,g=>{var l;return null!=(l={"<":"&lt;",">":"&gt;"}[g])?l:g}))?b:""}function ca(a,c,b){"boolean"==typeof c?(b=c,c=void 0):b="undefined"!=typeof b?b:!1;"undefined"==typeof c&&(K=-1);c=c||[];if(Array.isArray(a)){var g=b,l;b=0;for(l=a.length;b<l;b++)a[b]=ca(a[b],
c,g)}else{var k;c=da(ea(a,c));!0===b&&(c=fa(c));b=JSON.stringify(a);l=c.length;for(k=0;k<l;k++)a=c[k],b=b.replace(new RegExp('(?:"'+a[1].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")+'"):',"g"),'"'+a[0]+'":');a=(g=JSON.parse(b),g._=Qa(c),g)}return a}function ha(a){a=JSON.parse(JSON.stringify(a));if(Array.isArray(a)){var c;var b=0;for(c=a.length;b<c;b++)a[b]=ha(a[b])}else{var g=JSON.parse(JSON.stringify(a._));delete a._;c=JSON.stringify(a);for(b in g)"undefined"!=typeof g[b]&&(c=c.replace(new RegExp('(?:"'+
b+'"):',"g"),'"'+g[b]+'":'));g=c}return g?JSON.parse(g):a}function ia(a,c){var b,g=a.length;for(b=0;b<g;b++)if(a[b][1]===c)return!0;return!1}function da(a){var c,b=a.length,g=[];for(c=0;c<b;c++)ia(g,a[c][1])||g.push(a[c]);return g}function Qa(a){return a.reduce((c,b)=>(c[b[0]]=b[1],c),{})}function ja(a,c,b=0){var g=[];for(c=c||71;a>=c;)g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=_!?()*".charCodeAt(a%c+b)),a=Math.floor(a/c-1);return g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=_!?()*".charCodeAt(a+
b)),g.reverse()}function ea(a,c){var b,g,l;for(g in a)"undefined"!=typeof a[g]&&(l=a[g],((null==l?void 0:l.constructor)===Object||Array.isArray(l))&&(c=c.concat(da(ea(l,c)))),isNaN(Number(g))&&(ia(c,g)||(K+=1,b=[String.fromCharCode.apply(String,ja(K)),g],c.push(b))));return c}function fa(a){var c,b=a.length,g={};for(c=0;c<b;c++)g[a[c][0]]=c;for(c=0;c<b;c++){var l=a[c][1];if("undefined"!=typeof g[l])return c=g[l],K+=1,a[c][0]=String.fromCharCode.apply(String,ja(K)),g[c]=a[c][0],delete g[l],fa(a)}return a}
var N=Object.defineProperty,Ra=Object.defineProperties,Sa=Object.getOwnPropertyDescriptor,Ta=Object.getOwnPropertyDescriptors,Ua=Object.getOwnPropertyNames,ka=Object.getOwnPropertySymbols,la=Object.prototype.hasOwnProperty,Va=Object.prototype.propertyIsEnumerable,ma=(a,c,b)=>c in a?N(a,c,{enumerable:!0,configurable:!0,writable:!0,value:b}):a[c]=b,L=(a,c)=>{for(var b in c||={})la.call(c,b)&&ma(a,b,c[b]);if(ka)for(b of ka(c))Va.call(c,b)&&ma(a,b,c[b]);return a},O=(a,c)=>Ra(a,Ta(c)),M=(a,c)=>()=>(a&&
(c=a(a=0)),c),D=(a,c)=>()=>(c||a((c={exports:{}}).exports,c),c.exports),E=(a,c)=>{for(var b in c)N(a,b,{get:c[b],enumerable:!0})},Wa=(a,c,b,g)=>{if(c&&"object"==typeof c||"function"==typeof c)for(let l of Ua(c))!la.call(a,l)&&l!==b&&N(a,l,{get:()=>c[l],enumerable:!(g=Sa(c,l))||g.enumerable});return a},P=a=>Wa(N({},"__esModule",{value:!0}),a),Z=(a,c,b)=>new Promise((g,l)=>{var k=f=>{try{e(b.next(f))}catch(h){l(h)}},d=f=>{try{e(b.throw(f))}catch(h){l(h)}},e=f=>f.done?g(f.value):Promise.resolve(f.value).then(k,
d);e((b=b.apply(a,c)).next())}),Xa=D((a,c)=>{c.exports=function(b,g,l){var k=b.length;if(!(g>=k||0===l)){l=g+l>k?k-g:l;for(k-=l;g<k;++g)b[g]=b[g+l];b.length=k}}}),H=D((a,c)=>{function b(g,l){if(!g)throw Error(l||"AssertionError");}b.notEqual=function(g,l,k){b(g!=l,k)};b.notOk=function(g,l){b(!g,l)};b.equal=function(g,l,k){b(g==l,k)};b.ok=b;c.exports=b}),Ya=D((a,c)=>{function b(k){this.method=(this.hasIdle=(this.hasWindow=k)&&window.requestIdleCallback)?window.requestIdleCallback.bind(window):this.setTimeout;
this.scheduled=!1;this.queue=[]}var g=H(),l="undefined"!=typeof window;b.prototype.push=function(k){g.equal(typeof k,"function","nanoscheduler.push: cb should be type function");this.queue.push(k);this.schedule()};b.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var k=this;this.method(function(d){for(var e;k.queue.length&&0<d.timeRemaining();)e=k.queue.shift(),e(d);k.scheduled=!1;k.queue.length&&k.schedule()})}};b.prototype.setTimeout=function(k){setTimeout(k,0,{timeRemaining:function(){return 1}})};
c.exports=function(){var k;return l?(window._nanoScheduler||(window._nanoScheduler=new b(!0)),k=window._nanoScheduler):k=new b,k}}),Za=D((a,c)=>{function b(e){function f(p){var n="end-"+h+"-"+e;d.mark(n);l.push(function(){var r=null;try{d.measure(e+" ["+h+"]",m,n),d.clearMarks(m),d.clearMarks(n)}catch(q){r=q}p&&p(r,e)})}if(k.equal(typeof e,"string","nanotiming: name should be type string"),b.disabled)return g;var h=(1E4*d.now()).toFixed()%Number.MAX_SAFE_INTEGER,m="start-"+h+"-"+e;d.mark(m);return f.uuid=
h,f}function g(e){e&&l.push(function(){e(Error("nanotiming: performance API unavailable"))})}var l=Ya()(),k=H();b.disabled=!0;try{var d=window.performance;b.disabled="true"===window.localStorage.DISABLE_NANOTIMING||!d.mark}catch(e){}c.exports=b}),$a=D((a,c)=>{function b(d){if(!(this instanceof b))return new b(d);this._name=d||"nanobus";this._starListeners=[];this._listeners={}}var g=Xa(),l=Za(),k=H();c.exports=b;b.prototype.emit=function(d){k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.emit: eventName should be type string or symbol");
for(var e=[],f=1,h=arguments.length;f<h;f++)e.push(arguments[f]);f=l(this._name+"('"+d.toString()+"')");h=this._listeners[d];return h&&0<h.length&&this._emit(this._listeners[d],e),0<this._starListeners.length&&this._emit(this._starListeners,d,e,f.uuid),f(),this};b.prototype.on=b.prototype.addListener=function(d,e){return k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.on: eventName should be type string or symbol"),k.equal(typeof e,"function","nanobus.on: listener should be type function"),"*"===
d?this._starListeners.push(e):(this._listeners[d]||(this._listeners[d]=[]),this._listeners[d].push(e)),this};b.prototype.prependListener=function(d,e){return k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.prependListener: eventName should be type string or symbol"),k.equal(typeof e,"function","nanobus.prependListener: listener should be type function"),"*"===d?this._starListeners.unshift(e):(this._listeners[d]||(this._listeners[d]=[]),this._listeners[d].unshift(e)),this};b.prototype.once=function(d,
e){function f(){e.apply(h,arguments);h.removeListener(d,f)}k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.once: eventName should be type string or symbol");k.equal(typeof e,"function","nanobus.once: listener should be type function");var h=this;this.on(d,f);return this};b.prototype.prependOnceListener=function(d,e){function f(){e.apply(h,arguments);h.removeListener(d,f)}k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.prependOnceListener: eventName should be type string or symbol");k.equal(typeof e,
"function","nanobus.prependOnceListener: listener should be type function");var h=this;this.prependListener(d,f);return this};b.prototype.removeListener=function(d,e){function f(h,m){if(h&&(m=h.indexOf(m),-1!==m))return g(h,m,1),!0}return(k.ok("string"==typeof d||"symbol"==typeof d,"nanobus.removeListener: eventName should be type string or symbol"),k.equal(typeof e,"function","nanobus.removeListener: listener should be type function"),"*"===d)?(this._starListeners=this._starListeners.slice(),f(this._starListeners,
e)):("undefined"!=typeof this._listeners[d]&&(this._listeners[d]=this._listeners[d].slice()),f(this._listeners[d],e))};b.prototype.removeAllListeners=function(d){return d?"*"===d?this._starListeners=[]:this._listeners[d]=[]:(this._starListeners=[],this._listeners={}),this};b.prototype.listeners=function(d){d="*"!==d?this._listeners[d]:this._starListeners;var e=[];if(d)for(var f=d.length,h=0;h<f;h++)e.push(d[h]);return e};b.prototype._emit=function(d,e,f,h){if("undefined"!=typeof d&&0!==d.length)for(void 0===
f&&(f=e,e=null),e&&(void 0!==h?f=[e].concat(f,h):f=[e].concat(f)),e=d.length,h=0;h<e;h++){var m=d[h];m.apply(m,f)}}}),ab=D((a,c)=>{var b=H(),g=/(noopener|noreferrer) (noopener|noreferrer)/,l=/^[\w-_]+:/;c.exports=function(k,d){b.notEqual(typeof window,"undefined","nanohref: expected window to exist");d=d||window.document;b.equal(typeof k,"function","nanohref: cb should be type function");b.equal(typeof d,"object","nanohref: root should be type object");window.addEventListener("click",function(e){if(!(e.button&&
0!==e.button||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.defaultPrevented)){var f=function p(m){if(m&&m!==d)return"a"!==m.localName||void 0===m.href?p(m.parentNode):m}(e.target);!f||window.location.protocol!==f.protocol||window.location.hostname!==f.hostname||window.location.port!==f.port||f.hasAttribute("data-nanohref-ignore")||f.hasAttribute("download")||"_blank"===f.getAttribute("target")&&g.test(f.getAttribute("rel"))||l.test(f.getAttribute("href"))||(e.preventDefault(),k(f))}})}}),bb=D((a,
c)=>{c.exports="onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onmouseenter onmouseleave ontouchcancel ontouchend ontouchmove ontouchstart ondragstart ondrag ondragenter ondragleave ondragover ondrop ondragend onkeydown onkeypress onkeyup onunload onabort onerror onresize onscroll onselect onchange onsubmit onreset onfocus onblur oninput onanimationend onanimationiteration onanimationstart oncontextmenu onfocusin onfocusout".split(" ")}),cb=D((a,c)=>{function b(k,d,e){k[e]!==
d[e]&&(d[e]=k[e],k[e]?d.setAttribute(e,""):d.removeAttribute(e))}var g=bb(),l=g.length;c.exports=function(k,d){var e=k.nodeType,f=k.nodeName;if(1===e){for(var h=d.attributes,m=k.attributes,p=null,n,r=null,q=null,t,u=m.length-1;0<=u;--u)t=m[u],q=t.name,p=t.namespaceURI,n=t.value,p?(q=t.localName||q,r=d.getAttributeNS(p,q),r!==n&&d.setAttributeNS(p,q,n)):d.hasAttribute(q)?(r=d.getAttribute(q),r!==n&&("null"===n||"undefined"===n?d.removeAttribute(q):d.setAttribute(q,n))):d.setAttribute(q,n);for(m=h.length-
1;0<=m;--m)t=h[m],!1!==t.specified&&(q=t.name,p=t.namespaceURI,p?(q=t.localName||q,k.hasAttributeNS(p,q)||d.removeAttributeNS(p,q)):k.hasAttributeNS(null,q)||d.removeAttribute(q))}3!==e&&8!==e||d.nodeValue===k.nodeValue||(d.nodeValue=k.nodeValue);"INPUT"===f?(e=k.value,f=d.value,b(k,d,"checked"),b(k,d,"disabled"),k.indeterminate!==d.indeterminate&&(d.indeterminate=k.indeterminate),"file"!==d.type&&(e!==f&&(d.setAttribute("value",e),d.value=e),"null"===e&&(d.value="",d.removeAttribute("value")),k.hasAttributeNS(null,
"value")?"range"===d.type&&(d.value=e):d.removeAttribute("value"))):"OPTION"===f?b(k,d,"selected"):"TEXTAREA"===f&&(e=k.value,(e!==d.value&&(d.value=e),!d.firstChild||d.firstChild.nodeValue===e)||""===e&&d.firstChild.nodeValue===d.placeholder||(d.firstChild.nodeValue=e));for(e=0;e<l;e++)f=g[e],k[f]?d[f]=k[f]:d[f]&&(d[f]=void 0)}}),db=D((a,c)=>{function b(e,f){return f?e?e.isSameNode&&e.isSameNode(f)?f:e.tagName!==f.tagName||(e.dataset?e.dataset.nanomorphComponentId:void 0)!==(f.dataset?f.dataset.nanomorphComponentId:
void 0)?e:(d(e,f),g(e,f),f):null:e}function g(e,f){for(var h,m,p,n,r=0,q=0;h=f.childNodes[q],m=e.childNodes[q-r],h||m;q++)if(m)if(h)if(l(m,h))p=b(m,h),p!==h&&(f.replaceChild(p,h),r++);else{n=null;for(var t=q;t<f.childNodes.length;t++)if(l(f.childNodes[t],m)){n=f.childNodes[t];break}n?(p=b(m,n),p!==n&&r++,f.insertBefore(p,h)):m.id||h.id?(f.insertBefore(m,h),r++):(p=b(m,h),p!==h&&(f.replaceChild(p,h),r++))}else f.appendChild(m),r++;else f.removeChild(h),q--}function l(e,f){return e.id?e.id===f.id:e.isSameNode?
e.isSameNode(f):e.tagName!==f.tagName?!1:3===e.type?e.nodeValue===f.nodeValue:!1}var k=H(),d=cb();c.exports=function(e,f,h){return k.equal(typeof e,"object","nanomorph: oldTree should be an object"),k.equal(typeof f,"object","nanomorph: newTree should be an object"),h&&h.childrenOnly?(g(f,e),e):(k.notEqual(f.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),b(f,e))}}),eb=D((a,c)=>{var b=H();c.exports=function(g,l){b.equal(typeof g,"function","nanoraf: render should be a function");
b.ok("function"==typeof l||"undefined"==typeof l,"nanoraf: raf should be a function or undefined");l||=window.requestAnimationFrame;var k=!1,d=null;return function(){null===d&&!k&&(k=!0,l(function(){k=!1;for(var e=d.length,f=Array(e),h=0;h<e;h++)f[h]=d[h];g.apply(g,f);d=null}));d=arguments}}}),U,V,W=M(()=>{U=(a,c,b={})=>{function g(f,h){if(f.preventDefault(),!confirm("Permanently delete image from all pages in wiki?"))return!1;delete a.p.img[h.id];0<h.pgs.length&&(a.p.pages=a.p.pages.map(m=>(m.content&&
(m.content=m.content.replaceAll(`img:${h.id}:img`,"deleted")),m)));c(l.CHECK_CHANGED)}let {events:l}=a,{showDelete:k=!1,showUsed:d=!1,insert:e=null}=b;b=function(){let {pages:f,img:h}=a.p;return Object.keys(h).map(m=>O(L({id:m},h[m]),{pgs:d?f.filter(p=>{var n;return null==(n=p.content)?void 0:n.includes(`img:${m}:img`)}):[]}))}();return html`<section> <h1>Existing Images</h1> ${b.map(f=>html`<div class="ib at ed w14"> <div class=g> <img src=${f.img} class=w1 aria-describedby=alt> <span id=alt class=db>${f.alt} (${f.size[0]}x${f.size[1]}px)</span> <div class=pb> <button onclick=${h=>
{var m=f.img;h.preventDefault();h=new Image;h.src=m;window.open("").document.write(h.outerHTML)}}>View</button> ${k?html`<button onclick=${h=>{var m;h.preventDefault();a.p.img[f.id].alt=null!=(m=prompt("Alt text:",f.alt))?m:f.alt;c(l.CHECK_CHANGED)}}>Edit Alt</button>`:""} ${k?html`<button class=del onclick=${h=>g(h,f)}>Delete</button>`:""} ${e?html`<button onclick=${h=>e(h,f)}>Insert</button>`:""} </div> ${d?[html`<details> <summary class=b>Used in ${f.pgs.length} pages</summary> <ul> ${f.pgs.map(h=>
html`<li><a href="?page=${h.slug}">${h.name}</a></li>`)} </ul> </details>`]:""} </div> </div>`)} </section>`};V=(a,c)=>html`<dialog id=g> <form class=fr method=dialog> <button>Close</button> </form> ${U(a,()=>{},{insert:(b,g)=>FW.img.put(b,g,c)})} </dialog>`}),na={};E(na,{editor:()=>oa});var oa,fb=M(()=>{W();oa=a=>{function c({id:g}){g=`![](img:${g}:img)`;if(document.activeElement!==b&&b.focus(),document.selection)document.selection.createRange().text=g;else if(b.selectionStart||0===b.selectionStart){var l=
b.selectionStart,k=b.selectionEnd;b.value=b.value.substring(0,l)+g+b.value.substring(k,b.value.length);b.selectionStart=l+g.length;b.selectionEnd=l+g.length}else b.value+=g;a.edits.content=b.value}let b=html`<textarea onchange=${g=>a.edits.content=g.target.value}>${a.edits.content}</textarea>`;return[b,html`<button onclick=${g=>{g.preventDefault();FW.img.upload(a,c)}}>Insert Image from File</button>`,html`<button onclick=${g=>{g.preventDefault();document.getElementById("g").showModal()}}>Add Existing Image</button>`,
V(a,c)]}}),pa={};E(pa,{editor:()=>qa});var qa,gb=M(()=>{W();qa=(a,c)=>{function b(h){let m=f.children[1];document.activeElement!==m&&m.focus();l("insertHTML",`<p><img src="${h.img}#${h.id}"></p>`)}let {init:g,exec:l}=ed,{src:k,edits:d}=a,{content:e}=d,f=document.querySelector("#e");k?f=html`<textarea onchange=${h=>a.edits.content=h.target.value}>${FW.img.abbr(e)}</textarea>`:(f||(f=g({element:html`<div id=e class=ed></div>`,onChange:h=>a.edits.content=h,insert:()=>FW.img.upload(a,b)}),f.isSameNode=
()=>!0),f.content.innerHTML=e.includes("<img ")?FW.inject.img(e,a,!0):e);return[f,html`<div class="w1 tr pb"> <button onclick=${(function(h){h.preventDefault();a.src=!k;c(a.events.RENDER)})}>${k?"Show Editor":"Show HTML"}</button> </div>`,V(a,b)]}}),hb=D((a,c)=>{c.exports=function(g){return function(l,k,d){for(var e in k)e in b&&(k[b[e]]=k[e],delete k[e]);return g(l,k,d)}};var b={class:"className",for:"htmlFor","http-equiv":"httpEquiv"}}),ib=D((a,c)=>{var b=hb();c.exports=function(l,k){function d(f){return"function"==
typeof f||"string"==typeof f||f&&"object"==typeof f||null==f?f:e("",f)}k||={};var e=k.concat||function(f,h){return String(f)+String(h)};return!1!==k.attrToProp&&(l=b(l)),function(f){function h(B){var z=[];7===m&&(m=4);for(var x=0;x<B.length;x++){var w=B.charAt(x);1===m&&"<"===w?(p.length&&z.push([1,p]),p="",m=2):">"===w&&9!==m&&10!==m&&13!==m?(2===m&&p.length?z.push([2,p]):5===m?z.push([5,p]):8===m&&p.length&&z.push([8,p]),z.push([3]),p="",m=1):13===m&&/-$/.test(p)&&"-"===w?(k.comments&&z.push([8,
p.substr(0,p.length-1)]),p="",m=1):2===m&&/^!--$/.test(p)?(k.comments&&z.push([2,p],[5,"comment"],[11]),p=w,m=13):1===m||13===m?p+=w:2===m&&"/"===w&&p.length||(2===m&&/\s/.test(w)?(p.length&&z.push([2,p]),p="",m=4):2===m?p+=w:4===m&&/[^\s"'=/]/.test(w)?(m=5,p=w):4===m&&/\s/.test(w)?(p.length&&z.push([5,p]),z.push([12])):5===m&&/\s/.test(w)?(z.push([5,p]),p="",m=6):5===m&&"="===w?(z.push([5,p],[11]),p="",m=7):5===m?p+=w:6!==m&&4!==m||"="!==w?6!==m&&4!==m||/\s/.test(w)?7===m&&'"'===w?m=10:7===m&&"'"===
w?m=9:10===m&&'"'===w?(z.push([8,p],[12]),p="",m=4):9===m&&"'"===w?(z.push([8,p],[12]),p="",m=4):7!==m||/\s/.test(w)?8===m&&/\s/.test(w)?(z.push([8,p],[12]),p="",m=4):(8===m||9===m||10===m)&&(p+=w):(m=8,x--):(z.push([12]),/[\w-]/.test(w)?(p+=w,m=5):m=4):(z.push([11]),m=7))}return 1===m&&p.length?(z.push([1,p]),p=""):8===m&&p.length?(z.push([8,p]),p=""):10===m&&p.length?(z.push([8,p]),p=""):9===m&&p.length?(z.push([8,p]),p=""):5===m&&(z.push([5,p]),p=""),z}for(var m=1,p="",n=arguments.length,r=[],
q=0;q<f.length;q++)if(q<n-1){var t=arguments[q+1],u=h(f[q]),v=m;10===v&&(v=8);9===v&&(v=8);7===v&&(v=8);4===v&&(v=5);2===v?"/"===p?(u.push([2,"/",t]),p=""):u.push([2,t]):13===v&&k.comments?p+=String(t):13!==v&&u.push([0,v,t]);r.push.apply(r,u)}else r.push.apply(r,h(f[q]));n=[null,{},[]];t=[[n,-1]];for(q=0;q<r.length;q++){v=t[t.length-1][0];u=r[q];var A=u[0];if(2===A&&/^\//.test(u[1]))u=t[t.length-1][1],1<t.length&&(t.pop(),t[t.length-1][0][2][u]=l(v[0],v[1],v[2].length?v[2]:void 0));else if(2===A)u=
[u[1],{},[]],v[2].push(u),t.push([u,v[2].length-1]);else if(5===A||0===A&&5===u[1]){u="";for(var y;q<r.length;q++)if(5===r[q][0])u=e(u,r[q][1]);else if(0===r[q][0]&&5===r[q][1])if("object"!=typeof r[q][2]||u)u=e(u,r[q][2]);else for(y in r[q][2])r[q][2].hasOwnProperty(y)&&!v[1][y]&&(v[1][y]=r[q][2][y]);else break;11===r[q][0]&&q++;for(A=q;q<r.length;q++)if(8===r[q][0]||5===r[q][0])v[1][u]?""===r[q][1]||(v[1][u]=e(v[1][u],r[q][1])):v[1][u]=d(r[q][1]);else if(0!==r[q][0]||8!==r[q][1]&&5!==r[q][1]){!u.length||
v[1][u]||q!==A||3!==r[q][0]&&12!==r[q][0]||(v[1][u]=u.toLowerCase());3===r[q][0]&&q--;break}else v[1][u]?""===r[q][2]||(v[1][u]=e(v[1][u],r[q][2])):v[1][u]=d(r[q][2])}else if(5===A)v[1][u[1]]=!0;else if(0===A&&5===u[1])v[1][u[2]]=!0;else if(3===A)g.test(v[0])&&t.length&&(u=t[t.length-1][1],t.pop(),t[t.length-1][0][2][u]=l(v[0],v[1],v[2].length?v[2]:void 0));else if(0===A&&1===u[1])void 0===u[2]||null===u[2]?u[2]="":u[2]||(u[2]=e("",u[2])),Array.isArray(u[2][0])?v[2].push.apply(v[2],u[2]):v[2].push(u[2]);
else if(1===A)v[2].push(u[1]);else if(11!==A&&12!==A)throw Error("unhandled: "+A);}if(1<n[2].length&&/^\s*$/.test(n[2][0])&&n[2].shift(),2<n[2].length||2===n[2].length&&/\S/.test(n[2][1])){if(k.createFragment)return k.createFragment(n[2]);throw Error("multiple root elements must be wrapped in an enclosing tag");}return Array.isArray(n[2][0])&&"string"==typeof n[2][0][0]&&Array.isArray(n[2][0][2])&&(n[2][0]=l(n[2][0][0],n[2][0][1],n[2][0][2])),n[2][0]}};var g=RegExp("^(area|base|basefont|bgsound|br|col|command|embed|frame|hr|img|input|isindex|keygen|link|meta|param|source|track|wbr|!--|animate|animateTransform|circle|cursor|desc|ellipse|feBlend|feColorMatrix|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|font-face-format|font-face-name|font-face-uri|glyph|glyphRef|hkern|image|line|missing-glyph|mpath|path|polygon|polyline|rect|set|stop|tref|use|view|vkern)(?:[.#][a-zA-Z0-9\u007f-\uffff_:-]+)*$")}),
jb=D((a,c)=>{var b=/\n[\s]+$/,g=/^\n[\s]+/,l=/[\s]+$/,k=/^[\s]+/,d=/[\n\s]+/g,e="a abbr b bdi bdo br cite data dfn em i kbd mark q rp rt rtc ruby s amp small span strong sub sup time u var wbr".split(" "),f=["code","pre","textarea"];c.exports=function n(m,p){if(Array.isArray(p))for(var r=m.nodeName.toLowerCase(),q=!1,t,u,v=0,A=p.length;v<A;v++){var y=p[v];if(Array.isArray(y))n(m,y);else{("number"==typeof y||"boolean"==typeof y||"function"==typeof y||y instanceof Date||y instanceof RegExp)&&(y=y.toString());
var B=m.childNodes[m.childNodes.length-1];"string"==typeof y?(q=!0,B&&"#text"===B.nodeName?B.nodeValue+=y:(y=m.ownerDocument.createTextNode(y),m.appendChild(y),B=y),v===A-1&&(q=!1,-1===e.indexOf(r)&&-1===f.indexOf(r)?(t=B.nodeValue.replace(g,"").replace(l,"").replace(b,"").replace(d," "),""===t?m.removeChild(B):B.nodeValue=t):-1===f.indexOf(r)&&(u=0===v?"":" ",t=B.nodeValue.replace(g,u).replace(k," ").replace(l,"").replace(b,"").replace(d," "),B.nodeValue=t))):y&&y.nodeType&&(q&&(q=!1,-1===e.indexOf(r)&&
-1===f.indexOf(r)?(t=B.nodeValue.replace(g,"").replace(b," ").replace(d," "),""===t?m.removeChild(B):B.nodeValue=t):-1===f.indexOf(r)&&(t=B.nodeValue.replace(k," ").replace(g,"").replace(b," ").replace(d," "),B.nodeValue=t)),(B=y.nodeName)&&(r=B.toLowerCase()),m.appendChild(y))}}}}),kb=D((a,c)=>{c.exports="svg altGlyph altGlyphDef altGlyphItem animate animateColor animateMotion animateTransform circle clipPath color-profile cursor defs desc ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect set stop switch symbol text textPath title tref tspan use view vkern".split(" ")}),
lb=D((a,c)=>{c.exports="async autofocus autoplay checked controls default defaultchecked defer disabled formnovalidate hidden ismap loop multiple muted novalidate open playsinline readonly required reversed selected".split(" ")}),mb=D((a,c)=>{c.exports=["indeterminate"]}),nb=D((a,c)=>{var b=ib(),g=jb(),l=kb(),k=lb(),d=mb();c.exports=function(e){function f(p,n,r){var q;-1!==l.indexOf(p)&&(n.namespace="http://www.w3.org/2000/svg");var t=!1;n.namespace&&(t=n.namespace,delete n.namespace);var u=!1;if(n.is&&
(u=n.is,delete n.is),t)u?q=e.createElementNS(t,p,{is:u}):q=e.createElementNS(t,p);else{if("!--"===p)return e.createComment(n.comment);u?q=e.createElement(p,{is:u}):q=e.createElement(p)}for(var v in n)if(n.hasOwnProperty(v)){p=v.toLowerCase();u=n[v];if("classname"===p&&(p="class",v="class"),"htmlFor"===v&&(v="for"),-1!==k.indexOf(p))if("true"===String(u))u=p;else if("false"===String(u))continue;"on"===p.slice(0,2)||-1!==d.indexOf(p)?q[v]=u:t?"xlink:href"===v?q.setAttributeNS("http://www.w3.org/1999/xlink",
v,u):/^xmlns($|:)/i.test(v)||q.setAttributeNS(null,v,u):q.setAttribute(v,u)}return g(q,r),q}function h(p){for(var n=e.createDocumentFragment(),r=0;r<p.length;r++)null!=p[r]&&(Array.isArray(p[r])?n.appendChild(h(p[r])):("string"==typeof p[r]&&(p[r]=e.createTextNode(p[r])),n.appendChild(p[r])));return n}var m=b(f,{comments:!0,createFragment:h});return m.default=m,m.createComment=f,m}}),ob=D((a,c)=>{c.exports=nb()(document)}),pb=D((a,c)=>{c.exports=function(b){var g=document.createElement("div");g.innerHTML=
b;b=g.childNodes;return Array.isArray(b)?b:[].slice.call(b)}}),ra={};E(ra,{default:()=>sa,exec:()=>C,init:()=>X});var Q,R,S,F,C,X,sa,qb=M(()=>{Q=(a,c,b)=>a.addEventListener(c,b);R=(a,c)=>a.appendChild(c);S=a=>document.createElement(a);F=a=>document.queryCommandState(a);C=(a,c=null)=>document.execCommand(a,!1,c);X=a=>{let c=[{icon:"\u2612",title:"Clear Formatting",result:()=>C("removeFormat")},{icon:"<b>B</b>",title:"Bold",state:()=>F("bold"),result:()=>C("bold")},{icon:"<i>I</i>",title:"Italic",state:()=>
F("italic"),result:()=>C("italic")},{icon:"<u>U</u>",title:"Underline",state:()=>F("underline"),result:()=>C("underline")},{icon:"<b>H</b>",title:"Heading",result:()=>C("formatBlock","<h2>")},{icon:"<b>H<sub>2</sub></b>",title:"Sub-Heading",result:()=>C("formatBlock","<h3>")},{icon:"\u00b6",title:"Paragraph",result:()=>C("formatBlock","<p>")},{icon:"\u21a6",title:"Align Left",state:()=>F("justifyLeft"),result:()=>C("justifyLeft")},{icon:"\u2194",title:"Align Center",state:()=>F("justifyCenter"),result:()=>
C("justifyCenter")},{icon:"\u21a4",title:"Align Right",state:()=>F("justifyRight"),result:()=>C("justifyRight")},{icon:"#",title:"Number List",result:()=>C("insertOrderedList")},{icon:"\u2022",title:"Bullet List",result:()=>C("insertUnorderedList")},{icon:"\u201c \u201d",title:"Quote",result:()=>C("formatBlock","<blockquote>")},{icon:"\u2015",title:"Separator",result:()=>C("insertHorizontalRule")},{icon:"\ud83d\udd17",title:"Link",result:()=>{let l=window.prompt("Link URL:");l&&C("createLink",l)}},
{title:"Link External Image",icon:"\ud83d\uddbc\ufe0f",result:()=>{let l=window.prompt("Image URL:");l&&C("insertImage",l)}},{title:"Insert Image from File",icon:"\ud83d\udcf8",result:a.insert},{title:"Add Existing Image",icon:"\ud83d\udcce",result:()=>document.getElementById("g").showModal()}],b=S("div");b.className="ed-actionbar";b.role="toolbar";R(a.element,b);let g=a.element.content=S("div");return g.contentEditable=!0,g.className="ed-content",g.oninput=({target:{firstChild:l}})=>{l&&3===l.nodeType?
C("formatBlock","<p>"):"<br>"===g.innerHTML&&(g.innerHTML="");a.onChange(g.innerHTML)},g.onkeydown=l=>{"Enter"===l.key&&"blockquote"===document.queryCommandValue("formatBlock")&&setTimeout(()=>C("formatBlock","<p>"),0)},R(a.element,g),c.forEach(l=>{let k=S("button");if(k.className="ed-button",k.innerHTML=l.icon,k.title=l.title,k.setAttribute("type","button"),k.onclick=()=>l.result()&&g.focus(),l.state){let d=()=>k.classList[l.state()?"add":"remove"]("ed-selected");Q(g,"keyup",d);Q(g,"mouseup",d);
Q(k,"click",d)}R(b,k)}),C("defaultParagraphSeparator","p"),a.element};sa={exec:C,init:X}}),ta={};E(ta,{default:()=>Ca});var I,ua,G,rb=M(()=>{I={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;","[":"&#91;","]":"&#93;","(":"&#40;",")":"&#41;",_:"&#95;","*":"&ast;","`":"&#96;"};ua=Object.keys(I).filter(a=>"&"!=a).map(a=>I[a].replace("&"!=a?"&":"",""));G=a=>a.replace(/[<>&\(\)\[\]"']/g,c=>I[c]||c).replace(new RegExp(`&amp;(${ua.join("|")})`,"g"),"&$1")}),Da=$a(),sb=ab(),va=db(),tb=eb(),wa=a=>
{"complete"===document.readyState||"interactive"===document.readyState?a():document.addEventListener("DOMContentLoaded",a)},Y=()=>{let a={};return(new URLSearchParams(window.location.search)).forEach((c,b,g)=>{c=g.getAll(b);a[b]=1<c.length?c:c[0]}),a},ub={};J.prototype.start=function(){let a=()=>{let b=document.getElementById(location.hash.substring(1));return b?(null==b||b.scrollIntoView(),!0):!1};this.emitter.prependListener(this._events.GO,(b=null,g="push")=>{b&&history[g+"State"](ub,this.state.title,
b);this.state.query=Y();this._loaded&&this.emit(this._events.RENDER,()=>{a()||window.scroll(0,0)})});window.onpopstate=()=>{this.emit(this._events.GO)};sb(({href:b})=>{b!==window.location.href&&this.emit(this._events.GO,b)});var c=()=>this._view(this.state,this.emit);return this._tree=c(),this._rq=[],this._rd=null,this.emitter.prependListener(this._events.RENDER,b=>{"function"==typeof b&&this._rq.push(b);null!==this._rd&&clearTimeout(this._rd);this._rd=setTimeout(tb(()=>{var g=c();for(va(this._tree,
g);0<this._rq.length;)this._rq.shift()()}),9)}),wa(()=>{this.emit(this._events.ONLOAD);this._loaded=!0;a()}),this._tree};J.prototype.mount=function(a){wa(()=>{var c=this.start();"string"==typeof a?this._tree=document.querySelector(a):this._tree=a;va(this._tree,c)})};var vb=(a,c)=>{let {p:b,help:g}=a;return[html`<header> <h1>All Pages</h1> </header>`,html`<article> <p>This wiki has ${b.pages.length} page${1!==b.pages.length?"s":""}:</p> <ul> ${b.pages.filter(l=>!l.parent).map(l=>g.getChildList(l))} </ul> </article>`]};
W();var wb=(a,c)=>{function b(){FW.upload("text/html",n=>{FW.xtr(n,r=>{r&&(a.p=r[0],g(r[1]),l(r[2]),c(e.ONLOAD),c(e.CHECK_CHANGED),c(e.NOTIFY,"Wiki Loaded"))})})}function g(n){let r=document.getElementById("c");n.trim()?(a.c=n,r?r.innerHTML=n:document.head.innerHTML+=`<style id=c>${n}</style>`):(delete a.c,r&&document.head.removeChild(r))}function l(n){n.trim()?(a.j!==n&&alert("You must save & reload to run your JavaScript"),a.j=n):delete a.j}var k,d;let {events:e,p:f,c:h,j:m}=a,p=f.pages.map(n=>
n.slug).join("\n");return[html`<header> <h1>Wiki Settings</h1> </header>`,html`<article class=mw> <form onsubmit=${(function(n){n.preventDefault();n=n.currentTarget;let r=n.wTitle.value.trim();if(1>r.length)return alert("Title is required");a.p.name=r;a.p.desc=n.wDesc.value.trim();1<n.home.value.length?a.p.home=n.home.value:delete a.p.home;let q=n.wPo.value.split("\n").map(t=>t.trim());a.p.pages.sort((t,u)=>q.indexOf(t.slug)<q.indexOf(u.slug)?-1:1);g(n.wCss.value);l(n.wJs.value);n.wHead.value.trim()?
a.p.head=FW.inject.esc(n.wHead.value):delete a.p.head;a.p.static=n.wOut.checked;a.p.published=n.wPub.checked;c(e.CHECK_CHANGED);c(e.NOTIFY,"Settings updated")})} class=pb> <label for=wTitle>Wiki Title</label> <input class=w1 id=wTitle value=${f.name} minlength=1 required> <label for=wDesc>Wiki Description</label> <input class=w1 id=wDesc value=${f.desc}> <label for=home>Home Page</label> <select id=home> <option value="" selected=${!f.home}>All Pages (default)</option> ${f.pages.map(n=>html`<option selected=${n.id===
f.home} value=${n.id}>${n.name} (${n.slug})</option>`)} </select> <label for=wPo>Page Order</label> <textarea id=wPo class=notab>${p}</textarea> <label for=wCss>Custom CSS</label> <textarea id=wCss>${h}</textarea> <label for=wJs>Custom JS</label> <span class=h>Only runs once on wiki load. To test, save wiki & load that file.</span> <textarea id=wJs>${m}</textarea> <label for=wHead>Custom Head</label> <span class=h>Add HTML directly to <code>${html.raw("&lt;head&gt;")}</code>. To test, save wiki & load that file. Be careful! Malformed HTML will break wiki.</span> <textarea id=wHead>${FW.inject.esc(f.head,
!0)}</textarea> <label for=wOut>Include Static HTML</label> <input id=wOut type=checkbox checked=${null!=(k=f.static)?k:!1}> <span class=h>Include your wiki content in simple HTML for non-JS browsers. Nearly doubles output size.</span> <label for=wPub>Publish</label> <input id=wPub type=checkbox checked=${null!=(d=f.published)?d:!1}> <span class=h>Hides Save, New Page, & Wiki Settings buttons. You will need to manually visit <code>?page=s</code> to unset this when set.</span> <div class=tr> <button type=submit>Update</button> </div> </form> <div class=tr> <p class="pb h"> Feather Wiki Version: Wren_1.7.0 </p> <p> <button class=del onclick=${()=>
b()}>Import & Overwrite with Other Feather Wiki file</button> </p> </div> ${U(a,c,{showDelete:!0,showUsed:!0})} </article>`]},xb=(a,c)=>{let {p:b,query:g}=a;a=b.pages.filter(l=>{var k;return null==(k=l.tags)?void 0:k.includes(g.tag)});return[html`<header> <h1>Pages Tagged <code>${g.tag}</code></h1> </header>`,html`<article> ${0<a.length?html`<ul> ${a.map(l=>html`<li><a href="?page=${l.slug}">${l.name}</a></li>`)} </ul>`:"None Found"} </article>`]},yb=(a,c)=>{var b,g;let {img:l,pg:k,out:d,hLink:e}=
FW.inject,{help:f}=a,h=[],m=0,p=(null!=(b=c.content)?b:"").replace(RegExp("(<nowiki>.*<\\/nowiki>)","gs"),(n,r)=>(h[m]=r,`{nowiki-${m++}}`));p=FW.img.fix(p);p="md"===c.editor?md(p):p;p=l(k(e(d(p)),a),a);for(a=0;a<m;a++)p=p.replace(`{nowiki-${a}}`,h[a]);a=f.getChildren(c,!0);return[null!=c&&c.e||null==(g=null==c?void 0:c.tags)||!g.length?"":html`<aside> <dl class="db r"> <dt class=c><b>Tagged:</b></dt> <dd class=c> ${c.tags.replace(/,/g,", ")} </dd> </dl> </aside>`,html`<article class=uc> ${p?html.raw(p):
"No Page Content"} </article>`,0<a.length?html`<footer> <h2>Sub Pages</h2> <ul> ${a.map(n=>f.getChildList(n,!0))} </ul> </footer>`:null]},zb=(a,c,b)=>{function g(n){n=n.target;a.edits[n.id]=n.value;c(k.RENDER)}function l(){return FW.tidy(document.getElementById("tags").value.split(","))}let {events:k,edits:d,p:e,help:f}=a,h=f.getChildren(b).map(n=>n.id),m=!e.pages.some(n=>n.id===b.id);var {useMd:p}=d;p=[html`<div class="w1 tr"> <button onclick=${(function(n){n.preventDefault();let {useMd:r,content:q}=
d;r?confirm('Convert Markdown to HTML?\n("Cancel" to go without converting)')&&(a.edits.content=md(q)):a.edits.content=FW.img.abbr(q);a.edits.useMd=!r;c(k.RENDER)})}>${p?"Use Editor":"Use Markdown"}</button> </div>`,(p?(fb(),P(na)):(gb(),P(pa))).editor(a,c)];return html`<form onsubmit=${(function(n){n.preventDefault();n=n.currentTarget;let r=n.name.value.trim();if(1>r.length)return alert("Page Title cannot be blank.");let q=n.slug.value.trim();if(2>q.length)return alert("Page Slug must be more than 1 character long.");
let t=L({},b);t.name=r;t.slug=FW.slug(q);t.content=FW.img.fix(FW.img.abbr(a.edits.content),!0);t.tags=l().join(",");t.parent=n.parent.value;n.hide.checked?t.hide=!0:delete t.hide;d.useMd?t.editor="md":delete t.editor;c(k.UPDATE_PAGE,t)})}> <header> <h1>Edit Page</h1> <div class=r> <div class="c w12"> <label for=name>Page Title</label> <input id=name value=${d.name} required minlength=2 onchange=${g}> </div> <div class="c w12"> <label for=slug>Page Slug</label> <input id=slug value=${d.slug} required minlength=2 onchange=${g}> <button onclick=${(function(n){n.preventDefault();
document.getElementById("slug").value=FW.slug(document.getElementById("name").value.trim())})}>Slugify Title</button> </div> </div></header> <span class=h style=float:left>Internal links (hash optional): [[Page Title]] or [[text|page_slug#heading]].</span> ${p} <footer class=r> <div class="c w13"> <label for=tags>Page Tags</label> <input id=tags value=${d.tags} placeholder="Comma, Separated, List" onchange=${g}> <select onchange=${(function(n){let r=n.target.value;if(0<r.length){let q=l();q.includes(r)||
(d.tags+=(0<q.length?",":"")+r,c(k.RENDER))}n.target.value=""})}> <option value="" selected=selected disabled=disabled>Add Existing Tag</option> ${a.t.filter(n=>!d.tags.split(",").includes(n)).map(n=>html`<option>${n}</option>`)} </select> </div> <div class="c w13"> <label for=parent>Parent</label> <select id=parent onchange=${g}> <option value="" selected=${""===d.parent}>None</option> ${e.pages.filter(n=>n.id!==(null==b?void 0:b.id)&&!h.includes(n.id)).map(n=>html`<option selected=${n.id===d.parent} value=${n.id}>${n.name} (${n.slug})</option>`)} </select> <label>Hide Page <input type=checkbox id=hide onchange=${n=>
a.edits.hide=n.target.checked} checked=${d.hide}></label> </div> <div class="c w13 tr"> <div class=pb><button type=submit>Save</button></div> ${m?"":[html`<div class=pb><button onclick=${n=>{n.preventDefault();c(k.CANCEL_EDIT)}}>Cancel</button></div>`,html`<div><button class=del onclick=${n=>{n.preventDefault();confirm("You can't undo this after saving your wiki! Delete this page?")&&c(k.DELETE_PAGE,b.id)}}>Delete</button></div>`]} </div> </footer> </form>`},Ab=(a,c,b)=>{let {edit:g,help:l,p:k,events:d}=
a,{cd:e,md:f}=b;if(g)return zb(a,c,b);let h=l.breadcrumb(b),m=FW.date(new Date(e)),p=new Date(null!=f?f:e),n=FW.date(p);return[html`<header> ${html.raw(h.map(r=>`<a href="?page=${r.slug}">${r.name}</a> /`).join(" "))} <div class="r ns"> <h1 class=c>${b.name}</h1> ${b.e?"":html`<div class="c w14 tr"> <time datetime=${p.toISOString()}> ${m!==n?html`<abbr title="Created: ${m}">${n}</abbr>`:n} </time> ${k.published?"":html`<button onclick=${()=>c(d.START_EDIT)}>Edit</button> `} </div>`} </div> </header>`,
yb(a,b)]},Bb=(a,c)=>{a=a.help.missing();return[html`<header> <h1>Missing Pages</h1> </header>`,html`<article> <p>This wiki has ${a.length} page${1!==a.length?"s":""} referenced that don't exist:</p> <ul> ${a.map(b=>html`<li>${b}</li>`)} </ul> </article>`]},xa=(a,c)=>{function b(x){x.preventDefault();x=x.currentTarget.np.value.trim();if(2>x.length)return alert("Enter more than 1 character to create a new page.");c(p.CREATE_PAGE,x.trim())}function g(x){a.sbTab=x.target.innerText;c(p.RENDER)}var l,k;
let {help:d,pg:e,p:f,t:h,recent:m,events:p,query:n,changed:r,sb:q,sbTab:t,views:u,notis:v}=a,A=!f.published||"s"===n.page,y=f.pages.filter(x=>!x.parent),B=m.sort((x,w)=>x.t>w.t?-1:1).map(x=>f.pages.find(w=>w.id===x.p)),z=e?u.p(a,c,e):(null!=(k=u[null!=(l=n.page)?l:"a"])?k:()=>{})(a,c);n.tag&&(z=u.t(a,c));l=[r?html`<div>Wiki has changed!</div>`:""];return l=[...l,html`<div><button class=${r?"chg":""} title="Download wiki in its current state" onclick=${()=>c(p.SAVE_WIKI)}>Save Wiki</button></div>`],
html`<body> <main> <div class=sb> <span class=db><a href=? class=t>${f.name}</a></span> ${f.desc?html`<p class=pb>${f.desc}</p>`:""} ${A?l:""} <button class=sbt onclick=${()=>{a.sb=!a.sb;c(p.RENDER)}}>${q?"Hide":"Show"} Menu</button> <nav class=${q?"":"n"}> ${A?[html`<p><a href="?page=s">Wiki Settings</a></p>`,html`<details class=pb ontoggle=${()=>document.getElementById("np").focus()}> <summary class=np>New Page</summary> <form onsubmit=${b}> <label class=sr for=np>New Page Title</label> <input id=np placeholder="New Page Title" autocomplete=off> <button type=submit>Create</button> </form> </details>`]:
""} <div class=tabs> <button class=${"Pages"===t&&"a"} onclick=${g}>Pages</button> ${0<h.length?html`<button class=${"Tags"===t&&"a"} onclick=${g}>Tags</button>`:""} <button class=${"Recent"===t&&"a"} onclick=${g}>Recent</button> </div> ${"Pages"===t?html`<ul> ${y.map(x=>d.getChildList(x,!0))} <li><a href="?page=a">All Pages</a></li> ${0<d.missing().length?html`<li><a href="?page=m">Missing Pages</a></li>`:""} </ul>`:""} ${"Tags"===t?html`<ul> ${h.map(x=>html`<li><a href="?tag=${x}">${x}</a></li>`)} </ul>`:
""} ${"Recent"===t?html`<ul style=padding:0> ${B.map(x=>{var w;return html`<li> <a href="?page=${x.slug}">${x.name}</a> <p class=h style=margin:0>${FW.date(new Date(null!=(w=x.md)?w:x.cd))}</p> </li>`})} </ul>`:""} </nav> </div> <section>${z}</section> </main> <footer> <span class=fr>Powered by <a href=https://feather.wiki title="Version: Wren_1.7.0" target=_blank rel="noopener noreferrer">Feather Wiki</a></span> </footer> <div class=notis> ${Object.values(v)} </div> </body>`},ya={};E(ya,{abbr:()=>
Ia,fix:()=>Ja,put:()=>Ha,resizeImage:()=>aa,upload:()=>Ga});var za={};E(za,{object:()=>Ka,string:()=>ba});var Aa={};E(Aa,{esc:()=>Pa,hLink:()=>Oa,img:()=>Ma,out:()=>Na,pg:()=>La});var Ba={};E(Ba,{compress:()=>ca,decompress:()=>ha});var K=-1;window.html=ob();html.raw=pb();window.ed=(qb(),P(ra)).default;window.md=(rb(),P(ta)).default;window.FW=J();FW.slug=a=>null==a?void 0:a.toLowerCase().replace(/\s/g,"_").replace(/[\x00-\x2F\x3A-\x40[\\\]^`\x7B-\x7F]/g,"-");FW.date=a=>a.toLocaleString();FW.tidy=a=>
a.map(c=>c.trim()).filter((c,b,g)=>c.length&&g.indexOf(c)===b).sort();FW.xtr=function(a,c=()=>{}){let b=new FileReader;b.onload=g=>Z(this,null,function*(){let l=g.target.result;var k=T(l,"script","p type=application/json");if(!k.length||"{"!==k[0])return alert("Could not find Feather Wiki data.");k=FW.json.decompress(JSON.parse(k));k.img=yield Fa(k.img);c([k,T(l,"style","c"),T(l,"script","j")])});b.onerror=function(g){c(null)};b.readAsText(a)};FW.gen=function(a){function c(k){return html`<section> ${g.pages.map(d=>
{let e=a.views.p(k,"",d);return e[0].querySelector("h1").id="page="+d.slug,html`<article> ${e[0]} <div class=uc>${html.raw(e[1][1].innerHTML)}</div> </article>`})} </section>`}let {c:b,p:g,j:l}=a;return`<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <title>${g.name}</title> ${g.desc?`<meta name="description" content="${g.desc.replace(/"/g,'\\"')}">`:""} <meta name=version content=Wren_1.7.0> <meta name=application-name content="Feather Wiki"> <style id=s>${document.getElementById("s").innerHTML}</style> ${b?
`<style id=c>${b}</style>`:""} <script id=p type=application/json>${JSON.stringify(FW.json.compress(g))}<\/script> <script id=a>${document.getElementById("a").innerHTML}<\/script> ${FW.inject.esc(g.head,!0)} </head> <body> ${(function(){let k=O(L({},a),{edit:!1,sb:!0,sbx:new Set,pg:void 0,query:{page:"a"},p:O(L({},g),{published:!0})}),d=xa(k);if(d.querySelector(".sb .tabs").remove(),g.static){let e=d.querySelector("main>section");e.parentElement.replaceChild(c(k),e);d.querySelector(".sb>nav>ul>li:last-child,.sbt").remove()}return d.querySelectorAll("a").forEach(e=>
{e.classList.remove("a");e.href=e.href.includes("#")?e.href.replace(/.+(#.+)$/,"$1"):e.href.includes("page=")?e.href.replace(/.+(page=.+)(&.+)*?$/,g.static?"#$1":"?$1"):e.href.replace(location.toString().split("?")[0],"")}),d.querySelector("main").outerHTML})()} <footer><a href=https://src.feather.wiki/#versions>JavaScript required to edit</a></footer> ${l?`<script id=j>${l}<\/script>`:""} </body> </html>`};FW.img=ya;FW.hash=za;FW.inject=Aa;FW.json=Ba;FW.upload=function(a,c){a=html`<input type=file accept=${a} onchange=${b=>
{({files:b}=b.target);0<b.length&&c(b[0])}}>`;document.body.appendChild(a);a.click();document.body.removeChild(a)};(a=>{var c,b,g,l,k;a.root=location.pathname||"/";a.sb=!1;a.sbTab="Pages";a.sbx=new Set;a.recent=[];a.edit=!1;a.edits=null;a.keep=!1;a.src=!1;a.notis={};a.help={find:(d,e="slug")=>a.p.pages.find(f=>f[e]===d),getPage:()=>{let {query:d,help:e,p:f}=a;return!d.page&&f.home?e.find(f.home,"id"):e.find(d.page)},getParent:d=>a.p.pages.find(e=>e.id===(null==d?void 0:d.parent)),getChildren:(d,e)=>
a.p.pages.filter(f=>f.parent===(null==d?void 0:d.id)&&(!e||!f.hide)),getChildList:(d,e)=>{var f;if(e&&d.hide)return"";let {getChildren:h,getChildList:m}=a.help;var p=h(d,e);let n=null==(f=a.pg)?void 0:f.slug,r=n===d.slug,q=t=>{var u;return r||a.sbx.has(d.id)||(null!=(u=t.find(v=>v.slug===n||q(h(v,e))))?u:!1)};f=[html`<a href="?page=${d.slug}" class=${r?"a":""}>${d.name}</a>`,0<p.length?html`<ul>${p.map(t=>m(t,e))}</ul>`:""];p=e&&f[1]?html`<details open=${q(p)} onclick=${t=>a.sbx.add(d.id)} ontoggle=${t=>
{t.target.open||a.sbx.delete(d.id)}}> <summary>${f[0]}</summary> ${f[1]} </details>`:f;return html`<li> ${p} </li>`},missing:()=>a.p.pages.reduce((d,e)=>{let f=document.createElement("div");f.innerHTML=FW.inject.pg(e.content,a);e=[...f.getElementsByClassName("e")].filter(h=>d.every(m=>m.href!==h.href));return[...d,...e]},[]).sort(),breadcrumb:d=>{let e=[];for(d=a.help.getParent(d);d;)e.unshift(d),d=a.help.getParent(d);return e}};a.events=O(L({},a.events),{HANDLE_404:"404",CREATE_PAGE:"cp",START_EDIT:"se",
CANCEL_EDIT:"ce",UPDATE_PAGE:"up",DELETE_PAGE:"dp",COLLECT_TAGS:"ct",CHECK_CHANGED:"cc",SAVE_WIKI:"sw",NOTIFY:"n",REMOVE_NOTI:"rn"});a.views={a:vb,s:wb,t:xb,p:Ab,m:Bb};a.c=null!=(b=null==(c=document.querySelector("style#c"))?void 0:c.innerHTML)?b:"";a.j=null!=(l=null==(g=document.querySelector("script#j"))?void 0:g.innerHTML)?l:"";try{a.p=FW.json.decompress(JSON.parse(document.querySelector("script#p").innerHTML))}catch(d){a.p={name:"New Wiki",desc:"",pages:[],img:{}}}a.pg=a.help.getPage();c=[...a.p.pages].sort((d,
e)=>{var f,h;return(null!=(f=d.md)?f:d.cd)>(null!=(h=e.md)?h:e.cd)?-1:1});return a.useMd="md"===(null==(k=c[0])?void 0:k.editor),a.t=[],a.prev=FW.hash.object(a.p),a.now=a.prev,a.changed=!1,a})(FW.state);((a,c)=>{let {events:b,help:g,root:l,views:k}=a,d=()=>c.emit(...[b.TITLE,a.p.name+(a.pg?" | "+a.pg.name:"")]),e=()=>setTimeout(()=>document.querySelectorAll("textarea:not(.notab)").forEach(h=>h.onkeydown=Ea),300),f=()=>a.edits&&!confirm("Lose unsaved changes?");return c.on(b.ONLOAD,()=>{c.emit(...[b.HANDLE_404]);
d();c.emit(...[b.COLLECT_TAGS]);a.t.length?c.emit(...[b.RENDER]):e()}),c.on(b.RENDER,e),c.on(b.HANDLE_404,()=>{var {page:h}=a.query;if(1<(null==h?void 0:h.length)){let m=FW.slug(h);g.find(m)||k[m]||(h=h.split("_").map(p=>p[0].toUpperCase()+p.substring(1)).join(" "),c.emit(...[b.CREATE_PAGE,h,!1]))}else 0<(null==h?void 0:h.length)&&!k[h]&&(a.pg={e:!0,name:"404",content:"<p>Page not found</p>"},c.emit(...[b.RENDER]))}),c.on(b.GO,()=>{var h;let {p:m,pg:p}=a,n=null!=(h=a.query.page)?h:null;h=(null==p?
void 0:p.slug)===n||!n&&(null==p?void 0:p.id)===m.home;if(!h&&f())return history.go(-1);h||(a.edit=!1,a.edits=null,a.pg=g.getPage(),c.emit(...[b.HANDLE_404]),d())}),c.on(b.CREATE_PAGE,(h,m=!0)=>{if(!(2>h.length||f())){a.edit=!1;a.edits=null;var {p,query:n}=a,r=()=>{let v=[];for(let A=0;9>A;A++)v.push(String.fromCharCode(Math.round(94*Math.random())+32));return v.join("")};do var q=r();while(0<=p.pages.findIndex(v=>v.id===q));r=0;var t=FW.slug(h);do{var u=t+(0<r?"_"+r:"");r++}while(p.pages.some(v=>
v.slug===u));h={id:q,name:h,slug:u,cd:Date.now()};a.showNewPageField=!1;m?(a.p.pages.push(h),a.recent=[{p:h.id,t:h.cd},...a.recent].filter(v=>!!v.p),c.emit(...[b.CHECK_CHANGED]),c.emit(...[b.GO,l+"?page="+u,n.page!==u?"replace":"push"])):a.pg=h;c.emit(...[b.START_EDIT])}}),c.on(b.START_EDIT,()=>{var h,m,p,n,r;let {pg:q}=a;a.edit=!0;let t={name:null!=(h=q.name)?h:"",slug:null!=(m=q.slug)?m:"",content:FW.img.fix(null!=(p=q.content)?p:""),tags:null!=(n=q.tags)?n:"",parent:null!=(r=q.parent)?r:"",hide:!!q.hide};
t.useMd="md"===q.editor||!t.content&&a.useMd;a.edits=t;a.src=!1;c.emit(...[b.RENDER])}),c.on(b.CANCEL_EDIT,()=>{f()||(a.edit=!1,a.edits=null,c.emit(...[b.RENDER]))}),c.on(b.UPDATE_PAGE,h=>{let {p:m}=a;if(m.pages.some(n=>n.slug===h.slug&&n.id!==h.id))return alert('A page with the slug "'+h.slug+'" already exists!');let p=m.pages.findIndex(n=>n.id===h.id);Object.keys(h).forEach(n=>{1>h[n].length&&delete h[n]});h.md=Date.now();-1<p?m.pages[p]=h:m.pages.push(h);a.recent=[{p:h.id,t:h.md},...a.recent.filter(n=>
n.p!==h.id)].filter(n=>!!n.p);a.edit=!1;a.edits=null;a.useMd="md"===h.editor;c.emit(...[b.COLLECT_TAGS]);a.pg=g.getPage();c.emit(...[b.CHECK_CHANGED])}),c.on(b.DELETE_PAGE,h=>{a.p.pages=a.p.pages.map(m=>(m.parent===h&&delete m.parent,m)).filter(m=>m.id!==h);a.recent=a.recent.filter(m=>m.p!==h);a.edit=!1;a.edits=null;c.emit(...[b.COLLECT_TAGS]);delete a.pg;c.emit(...[b.GO,l]);c.emit(...[b.CHECK_CHANGED])}),c.on(b.COLLECT_TAGS,()=>{a.t=FW.tidy(a.p.pages.reduce((h,m)=>{var p,n;return[...h,...(null!=
(n=null==(p=m.tags)?void 0:p.split(","))?n:[])]},[]))}),c.on(b.CHECK_CHANGED,h=>{a.now=FW.hash.object(a.p);a.changed=a.prev!==a.now;c.emit(...[b.RENDER,h])}),c.on(b.NOTIFY,(h,m=5E3,p="background:#ddd; color:#000")=>{let n=Date.now();h=html`<div class=noti style=${p} id=${n} onclick=${()=>c.emit(...[b.REMOVE_NOTI,n])} title="Click to close"> <span role=alert>${h}</span><span class=fr>\u00d7</span> </div>`;a.notis[n]=h;0<m&&setTimeout(()=>c.emit(...[b.REMOVE_NOTI,n]),m);document.querySelector(".notis").appendChild(h)}),
c.on(b.REMOVE_NOTI,h=>{let m=a.notis[h];null==m||m.parentNode.removeChild(m);delete a.notis[h]}),c.on(b.SAVE_WIKI,()=>{var h=FW.gen(a);let {p:m}=a,p=document.createElement("a");p.setAttribute("href","data:text/html;charset=utf-8,"+encodeURIComponent(h));h=/\/$/.test(l)?"index.html":decodeURI(l.substring(l.lastIndexOf("/")+1));p.setAttribute("download",h);document.body.appendChild(p);p.click();document.body.removeChild(p);a.prev=FW.hash.object(m);c.emit(...[b.CHECK_CHANGED])}),c})(FW.state,FW.emitter);
window.addEventListener("beforeunload",a=>{if(FW.state.changed)return a.preventDefault(),a.returnValue="Lose unsaved changes?"},{capture:!0});FW._view=xa;FW.mount("body")})();
